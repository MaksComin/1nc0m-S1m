<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Simulation Tool</title>
    <style>
        /* Hide text content when showing results */
        #resultsSection:not([style*="display: none"]) ~ * #formTextContent,
        body:has(#resultsSection:not([style*="display: none"])) #formTextContent {
            display: none !important;
        }

        /* Expand form area when showing results */
        #resultsSection:not([style*="display: none"]) ~ .financial-tool-form,
        body:has(#resultsSection:not([style*="display: none"])) .financial-tool-form {
            min-width: 100% !important;
            flex: 1 1 100% !important;
        }

        /* Adjust wrapper when showing results */
        body:has(#resultsSection:not([style*="display: none"])) .financial-tool-wrapper {
            justify-content: center;
        }

        /* NEW RESULTS PAGE LAYOUT - MATCHING SCREENSHOT */
    
        /* Results container layout */
        .ft-results-container {
            display: flex;
            flex-direction: column;
            gap: 32px;
            will-change: transform;
        }

        @media (min-width: 769px) {
            .ft-results-container {
                display: grid;
                grid-template-columns: 1fr 400px;
                grid-template-rows: auto auto auto;
                gap: 32px;
                align-items: start;
            }
            
            /* Desktop layout for unified card */
            .ft-unified-results-card {
                grid-column: 1;
                grid-row: 1;
                margin: 0;
            }
            
            .ft-results-text {
                grid-column: 2;
                grid-row: 1;
                align-self: start;
                margin-top: 0;
            }
        }

        @media (max-width: 768px) {
            .ft-results-container {
                flex-direction: column !important;
            }
            
            .ft-results-right {
                flex: none !important;
                order: 2 !important; /* Show after results on mobile */
                margin-top: 40px;
                width: 100% !important;
            }
        }

        /* Force mobile styles when mobile-device class is added */
        body.mobile-device .ft-results-container {
            display: flex !important;
            flex-direction: column !important;
        }

        body.mobile-device .ft-results-left {
            order: 1 !important;
            width: 100% !important;
        }

        body.mobile-device .ft-results-right {
            order: 2 !important;
            margin-top: 40px !important;
            width: 100% !important;
            display: flex !important;
            flex-direction: column !important;
        }

        /* Mobile specific ordering for reordered layout */
        body.mobile-device .ft-comparison-cards {
            order: 1 !important;
        }



        body.mobile-device .ft-salary-breakdown {
            order: 3 !important;
        }

        body.mobile-device .ft-results-text {
            order: 4 !important;
            margin-top: 20px !important;
        }

        body.mobile-device .ft-results-actions {
            order: 5 !important;
        }



        /* Text content below image */
        .ft-results-text {
            background: #ffffff;
            border: 1px solid #e0e4e7;
            border-radius: 12px;
            padding: 32px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .ft-results-text h3 {
            font-size: 20px;
            font-weight: 700;
            color: #1a1a1a;
            margin: 0 0 16px 0;
            line-height: 1.3;
        }

        .ft-results-text p {
            font-size: 16px;
            color: #4a5568;
            line-height: 1.6;
            margin: 0;
        }

        .ft-results-text .ft-results-actions {
            margin-top: 24px;
            justify-content: flex-start;
        }

        @media (max-width: 768px) {

            
            .ft-results-text {
                padding: 20px;
            }
            
            .ft-results-text h3 {
                font-size: 16px;
            }
            
            .ft-results-text p {
                font-size: 13px;
            }
        }
    
        /* UNIFIED RESULTS CARD - COMBINING HEADER AND BREAKDOWN */
        .ft-unified-results-card {
            background: #ffffff;
            border: 1px solid #e0e4e7;
            border-radius: 20px;
            padding: 0;
            margin: 0 0 32px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .ft-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 32px 32px 24px 32px;
        }

        .ft-header-left {
            flex: 1;
            max-width: 60%;
        }

        .ft-main-title {
            font-size: 28px;
            font-weight: 700;
            color: #0D073F;
            margin: 0 0 16px 0;
            line-height: 1.2;
        }

        .ft-restitution-pill {
            background: #cef355;
            color: #000000;
            font-size: 14px;
            font-weight: 700;
            padding: 8px 16px;
            border-radius: 20px;
            display: inline-block;
            margin: 0 0 12px 0;
        }

        .ft-gross-salary-line {
            font-size: 16px;
            font-weight: 500;
            color: #4a5568;
            margin: 0;
        }

        .ft-header-right {
            text-align: right;
            min-width: 200px;
        }

        .ft-total-label {
            font-size: 14px;
            font-weight: 600;
            color: #4a5568;
            margin: 0 0 8px 0;
        }

        .ft-total-amount {
            font-size: 48px;
            font-weight: 600;
            color: #000000;
            margin: 0 0 4px 0;
            line-height: 1.1;
        }


        .ft-card-separator {
            height: 1px;
            background: linear-gradient(to right, transparent, #e0e4e7 20%, #e0e4e7 80%, transparent);
            margin: 0 32px;
        }

        .ft-card-breakdown {
            padding: 24px 32px 32px 32px;
        }

        .ft-breakdown-item {
            display: flex;
            align-items: center;
            padding: 2px 0;
            min-height: 60px;
        }

        .ft-breakdown-item:first-child {
            padding-top: 24px;
        }

        .ft-item-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
            min-width: 10px;
        }

        .ft-item-icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
            flex-shrink: 0;
        }

        .ft-item-label {
            font-size: 16px;
            font-weight: 600;
            color: #0D073F;
        }

        .ft-item-connector {
            flex: 1;
            height: 1px;
            background-image: repeating-linear-gradient(
                to right,
                #ade7a7 0,
                #ade7a7 4px,
                transparent 4px,
                transparent 8px
            );
            margin: 0 20px;
            align-self: center;
        }

        .ft-item-right {
            text-align: right;
            flex-shrink: 0;
        }

        .ft-item-amount {
            font-size: 18px;
            font-weight: 500;
            color: #0D073F;
            display: block;
            margin-bottom: 2px;
        }

        /* Action Buttons */
        .ft-results-actions {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 1px;
            padding-top: 3px;
            border-top: 1px solid #e0e4e7;
        }

        /* Mobile Responsive for Unified Design */
        @media (max-width: 768px) {
            .ft-unified-results-card {
                margin: 24px 0;
            }

            .ft-card-header {
                flex-direction: column;
                gap: 24px;
                padding: 24px 20px 20px 20px;
                align-items: center;
            }

            .ft-header-left {
                max-width: 100%;
                order: 1;
                width: 100%;
                text-align: center;
            }

            .ft-header-right {
                text-align: center;
                order: 2;
                min-width: auto;
                width: 100%;
            }

            .ft-main-title {
                font-size: 24px;
                text-align: center;
                margin: 0 0 16px 0;
            }

            .ft-restitution-pill {
                display: block;
                text-align: center;
                margin: 0 auto 12px auto;
                width: fit-content;
            }

    .ft-gross-salary-line {
        text-align: center;
        margin: 0;
    }

    .ft-total-amount {
        font-size: 40px;
    }

            .ft-card-separator {
                margin: 0 20px;
            }

            .ft-card-breakdown {
                padding: 20px 20px 24px 20px;
            }

            .ft-breakdown-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
                padding: 16px 0;
            }

            .ft-item-left {
                min-width: auto;
                width: 100%;
            }

            .ft-item-connector {
                display: none;
            }

            .ft-item-right {
                text-align: left;
                margin-left: 36px;
            }

            .ft-breakdown-header {
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                gap: 20px;
                text-align: center;
                padding-bottom: 24px;
                border-bottom: 1px solid #e0e4e7;
            }

            .ft-breakdown-right {
                text-align: center;
                width: 100%;
                max-width: 320px;
                margin: 0 auto;
                min-width: auto;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 0;
            }

            .ft-breakdown-title {
                font-size: 24px;
            }

            .ft-breakdown-total-amount {
                font-size: 28px;
            }

            .ft-component-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
                padding: 12px 0;
            }

            .ft-component-left {
                min-width: auto;
                width: 100%;
            }

            .ft-component-dots {
                display: none;
            }

            .ft-component-right {
                text-align: left;
                min-width: auto;
                margin-left: 36px;
            }

            .ft-results-actions {
                flex-direction: column;
                gap: 12px;
                margin-top: 24px;
            }

            .ft-btn {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .ft-comparison-card {
                padding: 20px 16px;
            }

            .ft-card-amount {
                font-size: 28px;
            }

            .ft-salary-breakdown {
                padding: 20px 16px;
            }

            .ft-breakdown-title {
                font-size: 20px;
            }

            .ft-breakdown-total-amount {
                font-size: 24px;
            }
        }
        
        /* Financial Tool - Self-Contained Styles */
        .financial-tool-container {
            max-width: 1200px;
            margin: 20px auto;
            font-family: "General Sans", Arial, sans-serif;
            line-height: 1.5;
            padding: 0 20px;
        }

        .financial-tool-wrapper {
            display: flex;
            gap: 40px;
            align-items: flex-start;
        }

        /* INCOM Info Box Styles */
        .incom-info-box {
            background: #cef355;
            border-radius: 12px;
            padding: 20px;
            box-sizing: border-box;
            font-family: "Generalsans", Arial, sans-serif;
            color: #000000;
            box-shadow: 0 2px 8px rgba(206, 243, 85, 0.2);
            margin-top: 24px;
            width: 100%;
            text-align: left;
        }

        .incom-info-header {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            cursor: pointer;
            user-select: none;
            gap: 12px;
            text-align: left;
        }

        /* Hide arrow on desktop */
        @media (min-width: 769px) {
            .incom-info-arrow {
                display: none;
            }
            
            .incom-info-header {
                cursor: default;
                justify-content: flex-start;
            }
        }

        .incom-info-title {
            font-size: 16px;
            font-weight: 600;
            line-height: 1.4;
            flex: 1;
            color: #000000 !important;
            text-align: left;
        }

        /* Desktop specific styling */
        @media (min-width: 769px) {
            .incom-info-title {
                font-size: 20px;
            }
        }

        .incom-info-arrow {
            font-size: 14px;
            color: #000000 !important;
            transition: transform 0.3s ease;
            flex-shrink: 0;
        }

        .incom-info-box.collapsed .incom-info-arrow {
            transform: rotate(180deg);
        }

        .incom-info-content {
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease, padding-top 0.3s ease;
            max-height: 200px;
            opacity: 1;
            padding-top: 16px;
            text-align: left;
        }

        .incom-info-box.collapsed .incom-info-content {
            max-height: 0;
            opacity: 0;
            padding-top: 0;
        }

        .incom-info-content p {
            margin: 0 0 12px 0;
            font-size: 14px;
            line-height: 1.5;
            color: #000000 !important;
            text-align: left;
        }

        .incom-info-content p:last-child {
            margin-bottom: 0;
        }

        .incom-info-highlight {
            font-weight: 600;
        }

        /* VTC Results Section Styles */
        .ft-results-content {
            padding: 20px 0;
            font-family: "Generalsans", Arial, sans-serif;
        }

        .ft-results-title {
            font-size: 24px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 24px;
            text-align: center;
        }

        /* Summary Card */
        .ft-summary-card {
            background: linear-gradient(135deg, #cef355, #b8e832);
            border-radius: 20px;
            padding: 32px 24px;
            margin-bottom: 32px;
            box-shadow: 0 8px 24px rgba(206, 243, 85, 0.3);
            border: none;
        }

        .ft-summary-content {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .ft-summary-icon {
            font-size: 48px;
            flex-shrink: 0;
        }

        .ft-summary-details {
            flex: 1;
        }

        .ft-summary-title {
            font-size: 16px;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0 0 8px 0;
            opacity: 0.8;
        }

        .ft-summary-amount {
            font-size: 36px;
            font-weight: 800;
            color: #1a1a1a;
            margin: 0 0 4px 0;
            line-height: 1.1;
        }

        .ft-summary-subtitle {
            font-size: 14px;
            font-weight: 600;
            color: #1a1a1a;
            opacity: 0.7;
            margin: 0;
        }

        /* VTC Breakdown Section */
        .ft-vtc-breakdown {
            background: #ffffff;
            border-radius: 16px;
            padding: 28px 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid #e0e4e7;
            margin-bottom: 24px;
        }

        .ft-breakdown-title {
            font-size: 20px;
            font-weight: 700;
            color: #1a1a1a;
            margin: 0 0 28px 0;
            text-align: center;
        }

        .ft-vtc-items {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .ft-vtc-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            position: relative;
            padding: 16px 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .ft-vtc-item:last-child {
            border-bottom: none;
        }

        .ft-vtc-item.ft-input-item {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 8px;
            border-bottom: none;
            margin-bottom: 8px;
        }

        .ft-vtc-item.ft-highlight-item {
            background: #f0fcff;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #cef355;
            border-bottom: none;
        }

        .ft-vtc-item.ft-deduction-item {
            background: #fff0f0; /* Light red background for deductions */
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #dc3545; /* Red border for deductions */
            border-bottom: none;
        }

        .ft-vtc-left {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex-shrink: 0;
            min-width: 200px;
        }

        .ft-vtc-icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
            display: inline-block;
            margin-right: 8px;
        }

        .ft-vtc-label {
            font-size: 15px;
            font-weight: 600;
            color: #1a1a1a;
            display: inline;
        }

        .ft-vtc-note {
            font-size: 12px;
            color: #6b7280;
            font-style: italic;
            margin-left: 32px;
        }

        .ft-vtc-dots {
            flex: 1;
            height: 1px;
            background-image: repeating-linear-gradient(
                to right,
                rgba(206, 243, 85, 0.6) 0,
                rgba(206, 243, 85, 0.6) 4px,
                transparent 4px,
                transparent 8px
            );
            margin: 0;
            align-self: center;
        }

        .ft-vtc-value {
            font-size: 18px;
            font-weight: 700;
            color: #1a1a1a;
            flex-shrink: 0;
            text-align: right;
            min-width: 100px;
        }

        /* Action Buttons */
        .ft-results-actions {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 4px;
            padding-top: 32px;
            border-top: 1px solid #e0e4e7;
        }

        .ft-btn-outline {
            background: transparent;
            border: 2px solid #1a1a1a;
            color: #1a1a1a;
        }

        .ft-btn-outline:hover {
            background: #1a1a1a;
            color: #ffffff;
        }

        .financial-tool-text {
            flex: 1;
            padding-right: 20px;
        }

        .financial-tool-text h2 {
            font-size: 32px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 16px;
            line-height: 1.2;
        }

        .financial-tool-text p {
            font-size: 18px;
            color: #4a5568;
            margin-bottom: 24px;
            line-height: 1.6;
        }

        .financial-tool-text ul {
            list-style: none;
            padding: 0;
            margin-bottom: 24px;
        }

        .financial-tool-text li {
            font-size: 16px;
            color: #4a5568;
            margin-bottom: 12px;
            padding-left: 28px;
            position: relative;
            text-align: left;
        }

        .financial-tool-text li::before {
            content: '✓';
            position: absolute;
            left: 0;
            top: 0;
            color: #cef355;
            font-weight: bold;
            font-size: 18px;
            width: 20px;
            text-align: center;
        }

        .benefits-highlight {
            background: linear-gradient(135deg, #cef355, #b8e832);
            padding: 16px 20px;
            border-radius: 12px;
            text-align: center;
            color: #1a1a1a;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(206, 243, 85, 0.3);
        }

        .financial-tool-form {
            flex: 1;
            background: transparent;
            border-radius: 0;
            box-shadow: none;
            padding: 0;
            border: none;
            min-width: 400px;
        }

        .ft-form-content {
            display: flex;
            flex-direction: column;
        }

        .ft-form-group {
            margin-bottom: 24px;
            position: relative;
            z-index: auto;
        }

        .ft-form-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .ft-form-input {
            width: 100%;
            padding: 12px 18px;
            border: 2px solid #e0e4e7;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s ease;
            background: #ffffff;
            box-sizing: border-box;
            height: 48px; /* Consistent height for all inputs */
            will-change: border-color;
        }

        .ft-form-input:focus {
            outline: none;
            border-color: #cef355;
        }

        .ft-form-input.ft-error {
            border-color: #dc3545;
        }

        /* Placeholder styling for select dropdown */
        .ft-form-input option[value=""] {
            color: #9ca3af;
            font-style: normal;
        }

        .ft-form-input:invalid {
            color: #9ca3af;
        }

        .ft-form-input:valid {
            color: #1a1a1a;
        }

        /* Currency input wrapper styling - FIXED */
        .ft-currency-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .ft-currency-input {
            padding-right: 40px !important; /* Make room for euro symbol */
        }

        .ft-currency-symbol {
            position: absolute;
            right: 18px;
            color: #6c757d;
            font-size: 16px;
            font-weight: 500;
            pointer-events: none;
            z-index: 1;
        }

        /* Placeholder styling */
        .ft-form-input::placeholder {
            color: #9ca3af;
            font-size: 16px;
            font-style: normal;
            opacity: 1;
        }

        /* Custom Dropdown Styling */
        .ft-custom-dropdown {
            position: relative;
            width: 100%;
            cursor: pointer;
        }

        .ft-dropdown-selected {
            width: 100%;
            padding: 12px 18px;
            border: 2px solid #e0e4e7;
            border-radius: 8px;
            font-size: 16px;
            background: #ffffff;
            box-sizing: border-box;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: border-color 0.3s;
            cursor: pointer;
        }

        .ft-dropdown-selected:focus,
        .ft-dropdown-selected:focus-within,
        .ft-custom-dropdown.ft-open .ft-dropdown-selected {
            outline: none;
            border-color: #cef355;
        }

        .ft-dropdown-selected.ft-error {
            border-color: #dc3545;
        }

        .ft-dropdown-placeholder {
            color: #9ca3af;
            font-size: 16px;
            font-style: normal;
            opacity: 1;
            flex: 1;
            user-select: none;
            text-align: left;
        }

        .ft-dropdown-selected.ft-has-value .ft-dropdown-placeholder {
            color: #1a1a1a;
        }

        .ft-dropdown-arrow {
            color: #6c757d;
            font-size: 12px;
            transition: transform 0.3s;
            user-select: none;
        }

        .ft-custom-dropdown.ft-open .ft-dropdown-arrow {
            transform: rotate(180deg);
        }

        .ft-dropdown-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #ffffff;
            border: 2px solid #cef355;
            border-top: none;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .ft-custom-dropdown.ft-open .ft-dropdown-options {
            display: block;
        }

        .ft-dropdown-option {
            padding: 12px 18px;
            font-size: 16px;
            color: #1a1a1a;
            cursor: pointer;
            transition: background-color 0.2s;
            user-select: none;
        }

        .ft-dropdown-option:hover {
            background-color: #f8fff0;
        }

        .ft-dropdown-option:last-child {
            border-radius: 0 0 6px 6px;
        }

        /* Vehicle options styling */
        .ft-vehicle-group .ft-form-input {
            display: none; /* Hide the hidden input */
        }

        .ft-vehicle-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 8px;
            height: 80px; /* Consistent height with other inputs */
            position: relative;
            z-index: 1;
        }

        /* Ensure vehicle group stays above other elements */
        .ft-vehicle-group {
            position: relative;
            z-index: 2;
            margin-bottom: 32px; /* Add extra space after vehicle selection */
            padding-bottom: 12px; /* Additional padding for clearance */
        }

        .ft-vehicle-option {
            padding: 8px 8px;
            border: 2px solid #e0e4e7;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.2s ease, background-color 0.2s ease;
            background: #ffffff;
            font-weight: 500;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            height: 100%;
            will-change: border-color, background-color;
        }

        .ft-vehicle-option:hover {
            border-color: #cef355;
            background: #f8fff0;
        }

        .ft-vehicle-option.ft-selected {
            border-color: #cef355;
            background: #cef355;
            color: #1a1a1a;
        }

        .ft-vehicle-option img {
            width: 40px;
            height: 28px;
            object-fit: contain;
            border-radius: 4px;
        }

        .ft-vehicle-option span {
            font-size: 12px;
            line-height: 1.2;
        }

        .ft-button-group {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            margin-top: 32px;
        }

        .ft-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            flex: 1;
            height: 48px; /* Consistent button height */
            will-change: background-color;
            transform: translateZ(0); /* Hardware acceleration */
        }

        .ft-btn:active {
            transform: translateY(1px);
        }

        .ft-btn-secondary {
            background: #6c757d;
            color: white;
        }

        .ft-btn-secondary:hover {
            background: #5a6268;
        }

        .ft-btn-primary {
            background: #cef355;
            color: #1a1a1a;
        }

        .ft-btn-primary:hover {
            background: #b8e832;
        }

        /* Style pour les liens avec classe ft-btn */
        a.ft-btn {
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        a.ft-btn:hover {
            text-decoration: none;
        }

        a.ft-btn:visited {
            color: inherit;
        }

        .ft-error-message {
            color: #dc3545;
            font-size: 11px;
            margin-top: 4px;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .financial-tool-container {
                margin: 16px auto;
                padding: 0;
                max-width: 100%;
                width: 100%;
                box-sizing: border-box;
            }
            
            .financial-tool-wrapper {
                flex-direction: column;
                gap: 24px;
                align-items: center;
                justify-content: center;
                min-height: auto;
                padding: 0 24px;
                box-sizing: border-box;
            }

            /* INCOM Info Box Mobile Styles */
            .incom-info-box {
                margin-top: 20px;
                padding: 18px;
            }

            /* Force collapsed state on mobile by default */
            .incom-info-box .incom-info-content {
                max-height: 0 !important;
                opacity: 0 !important;
                padding-top: 0 !important;
            }

            .incom-info-box .incom-info-arrow {
                transform: rotate(0deg) !important;
            }

            /* Only expand when explicitly set */
            .incom-info-box.mobile-expanded .incom-info-content {
                max-height: 200px !important;
                opacity: 1 !important;
                padding-top: 16px !important;
            }

            .incom-info-box.mobile-expanded .incom-info-arrow {
                transform: rotate(180deg) !important;
            }

            .incom-info-title {
                font-size: 15px;
                line-height: 1.3;
            }

            .incom-info-content p {
                font-size: 13px;
                line-height: 1.4;
                margin-bottom: 10px;
            }

            .financial-tool-text {
                padding: 0;
                text-align: center;
                width: 100%;
                max-width: 500px;
                box-sizing: border-box;
            }

            .financial-tool-text h2 {
                font-size: 28px;
                margin-bottom: 20px;
                line-height: 1.3;
            }

            .financial-tool-text p {
                font-size: 16px;
                margin-bottom: 28px;
                line-height: 1.5;
            }

            .financial-tool-text ul {
                text-align: left;
                margin-bottom: 0;
            }

            .financial-tool-text li {
                font-size: 15px;
                margin-bottom: 14px;
                line-height: 1.4;
            }
            
            .financial-tool-form {
                padding: 0;
                min-width: unset;
                width: 100%;
                max-width: 500px;
                margin: 0;
                box-sizing: border-box;
            }

            .ft-form-group {
                margin-bottom: 20px;
                width: 100%;
                box-sizing: border-box;
            }

            .ft-form-label {
                font-size: 15px;
                margin-bottom: 10px;
                font-weight: 600;
            }

            /* Ensure all input containers have equal left/right spacing */
            .ft-currency-input-wrapper,
            .ft-custom-dropdown,
            .ft-vehicle-options {
                width: 100%;
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }

            .ft-form-input {
                padding: 14px 18px;
                font-size: 16px;
                height: 52px;
                width: 100%;
                box-sizing: border-box;
                margin: 0;
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                border-radius: 10px;
            }

            /* Mobile-specific currency input adjustments */
            .ft-currency-input {
                padding: 14px 50px 14px 18px;
                width: 100%;
                box-sizing: border-box;
            }

            .ft-currency-symbol {
                right: 18px;
                font-size: 16px;
            }

            /* Dropdown improvements for mobile */
            .ft-dropdown-selected {
                padding: 14px 18px;
                height: 52px;
                font-size: 16px;
                border-radius: 10px;
                width: 100%;
                box-sizing: border-box;
                margin: 0;
            }

            .ft-dropdown-options {
                border-radius: 0 0 10px 10px;
                max-height: 180px;
                width: 100%;
                box-sizing: border-box;
            }

            .ft-dropdown-option {
                padding: 14px 18px;
                font-size: 16px;
            }
            
            .ft-vehicle-options {
                gap: 10px;
                height: 75px;
                margin-top: 10px;
                width: 100%;
                box-sizing: border-box;
                padding: 0;
            }

            /* Additional mobile spacing for vehicle group */
            .ft-vehicle-group {
                margin-bottom: 32px !important;
                padding-bottom: 16px !important;
            }
            
            .ft-vehicle-option {
                padding: 8px 6px;
                border-radius: 10px;
                min-height: 75px;
            }
            
            .ft-vehicle-option img {
                width: 36px;
                height: 26px;
            }
            
            .ft-vehicle-option span {
                font-size: 15px;
                font-weight: 600;
            }
            
            .ft-button-group {
                margin-top: 32px;
                gap: 0;
                width: 100%;
                box-sizing: border-box;
                padding: 0;
            }

            .ft-btn {
                padding: 16px 24px;
                font-size: 16px;
                font-weight: 700;
                height: 56px;
                border-radius: 12px;
                width: 100%;
                box-sizing: border-box;
                margin: 0;
            }

            /* iOS specific fixes */
            .ft-form-input:focus {
                transform: none;
                zoom: 1;
            }

            /* Prevent zoom on input focus for iOS */
            input[type="text"], 
            input[type="email"], 
            select {
                font-size: 16px !important;
            }
        }

        /* Small mobile screens */
        @media (max-width: 480px) {

            .financial-tool-container {
                margin: 12px auto;
                padding: 0;
                width: 100%;
                box-sizing: border-box;
            }

            .financial-tool-wrapper {
                gap: 20px;
                padding: 0 20px;
                box-sizing: border-box;
            }

            /* INCOM Info Box Small Mobile */
            .incom-info-box {
                padding: 16px;
                margin-top: 16px;
            }

            .incom-info-title {
                font-size: 14px;
            }

            .incom-info-content p {
                font-size: 12px;
                margin-bottom: 8px;
            }

            .financial-tool-text h2 {
                font-size: 24px;
                margin-bottom: 16px;
            }

            .financial-tool-text p {
                font-size: 15px;
                margin-bottom: 24px;
            }

            .financial-tool-text li {
                font-size: 14px;
                margin-bottom: 12px;
            }

            .financial-tool-form {
                padding: 0;
                max-width: 100%;
                width: 100%;
                box-sizing: border-box;
            }

            .ft-form-input {
                padding: 12px 16px;
                height: 48px;
                font-size: 16px;
                width: 100%;
                box-sizing: border-box;
            }

            .ft-currency-input {
                padding: 12px 45px 12px 16px;
                width: 100%;
                box-sizing: border-box;
            }

            .ft-currency-symbol {
                right: 16px;
                font-size: 15px;
            }

            .ft-dropdown-selected {
                padding: 12px 16px;
                height: 48px;
                width: 100%;
                box-sizing: border-box;
            }

            .ft-vehicle-options {
                height: 70px;
                gap: 8px;
                width: 100%;
                box-sizing: border-box;
            }

            /* Extra spacing for small mobile screens */
            .ft-vehicle-group {
                margin-bottom: 36px !important;
                padding-bottom: 20px !important;
            }

            .ft-vehicle-option {
                padding: 6px 4px;
                min-height: 70px;
            }

            .ft-vehicle-option img {
                width: 32px;
                height: 24px;
            }

            .ft-vehicle-option span {
                font-size: 14px;
            }

            .ft-btn {
                padding: 14px 20px;
                height: 50px;
                font-size: 15px;
                width: 100%;
                box-sizing: border-box;
            }
        }

        /* Medium screens */
        @media (max-width: 1024px) and (min-width: 769px) {
            .financial-tool-container {
                max-width: 900px;
            }
            
            .financial-tool-wrapper {
                gap: 30px;
            }

            .financial-tool-text h2 {
                font-size: 28px;
            }

            .financial-tool-form {
                min-width: 350px;
            }
        }
    </style>
</head>
<body>
    <!-- Financial Simulation Tool - Self-Contained -->
    <div class="financial-tool-container">
        <div class="financial-tool-wrapper">
            <!-- Left side text content - Hidden when showing results -->
            <div class="financial-tool-text" id="formTextContent">
                <h2>Estimez votre revenu net avec INCOM</h2>
                <p>Indiquez votre chiffre d'affaires et vos frais pro pour estimer votre salaire net avec INCOM</p>
                
                <!-- INCOM Info Box -->
                <div class="incom-info-box" id="incomInfoBox">
                    <div class="incom-info-header" id="incomInfoHeader">
                        <span class="incom-info-title">📊 En moyenne, les chauffeurs INCOM gagnent 500 € de plus par mois</span>
                        <span class="incom-info-arrow" id="incomInfoArrow">▼</span>
                    </div>
                    <div class="incom-info-content" id="incomInfoContent">
                        <p>Chez INCOM, vous êtes salarié tout en gardant votre liberté. Moins d'impôts, plus de protections sociales, un bulletin de paie chaque mois… et fini la paperasse.</p>
                    </div>
                </div>
            </div>

            <!-- Right side form -->
            <div class="financial-tool-form">
                <!-- Form Section -->
                <div id="formSection">
                    <form id="financialForm">
                        <div class="ft-form-content">
                            <!-- Chiffre d'affaires -->
                            <div class="ft-form-group">
                                <label for="ft-turnover" class="ft-form-label">Chiffre d'affaires mensuel net TTC</label>
                                <div class="ft-currency-input-wrapper">
                                    <input 
                                        type="text" 
                                        id="ft-turnover" 
                                        name="turnover"
                                        class="ft-form-input ft-currency-input" 
                                        placeholder="5 000"
                                        inputmode="numeric"
                                    >
                                    <span class="ft-currency-symbol">€</span>
                                </div>
                                <div class="ft-error-message" id="ft-turnover-error"></div>
                            </div>

                            <!-- Titularité du véhicule -->
                            <div class="ft-form-group">
                                <label for="ft-ownership" class="ft-form-label">Titularité du véhicule</label>
                                <div class="ft-custom-dropdown" id="ft-ownership-dropdown">
                                    <div class="ft-dropdown-selected" id="ft-ownership-selected">
                                        <span class="ft-dropdown-placeholder">Sélectionnez une option</span>
                                        <span class="ft-dropdown-arrow">▼</span>
                                    </div>
                                    <div class="ft-dropdown-options" id="ft-ownership-options">
                                        <div class="ft-dropdown-option" data-value="owner">Propriétaire</div>
                                        <div class="ft-dropdown-option" data-value="credit">Crédit véhicule (financement)</div>
                                        <div class="ft-dropdown-option" data-value="leasing">Leasing / Location longue durée</div>
                                    </div>
                                    <input type="hidden" id="ft-ownership" name="ownership" value="">
                                </div>
                                <div class="ft-error-message" id="ft-ownership-error"></div>
                            </div>

                            <!-- Montant mensuel crédit/leasing (conditional) -->
                            <div class="ft-form-group" id="ft-payment-group" style="display: none;">
                                <label for="ft-monthly-payment" class="ft-form-label" id="ft-payment-label">Montant mensuel</label>
                                <div class="ft-currency-input-wrapper">
                                    <input 
                                        type="text" 
                                        id="ft-monthly-payment" 
                                        name="monthlyPayment"
                                        class="ft-form-input ft-currency-input"
                                        placeholder="400"
                                        inputmode="numeric"
                                    >
                                    <span class="ft-currency-symbol">€</span>
                                </div>
                                <div class="ft-error-message" id="ft-monthly-payment-error"></div>
                            </div>

                            <!-- Frais professionnels -->
                            <div class="ft-form-group">
                                <label for="ft-expenses" class="ft-form-label">
                                    Montant des frais professionnels mensuels
                                </label>
                                <div class="ft-currency-input-wrapper">
                                    <input 
                                        type="text" 
                                        id="ft-expenses" 
                                        name="expenses"
                                        class="ft-form-input ft-currency-input"
                                        placeholder="1 500"
                                        inputmode="numeric"
                                    >
                                    <span class="ft-currency-symbol">€</span>
                                </div>
                                <div class="ft-error-message" id="ft-expenses-error"></div>
                            </div>

                            <!-- Type de véhicule -->
                            <div class="ft-form-group ft-vehicle-group">
                                <label class="ft-form-label">Type de véhicule</label>
                                <div class="ft-vehicle-options">
                                    <div class="ft-vehicle-option ft-selected" data-value="hybride">
                                        <img src="https://cdn.prod.website-files.com/6889fc5ff91302573d0cb517/688b40edae7fb206bff89c6c_voiture-hyrbide.png" alt="Véhicule hybride">
                                        <span>Hybride</span>
                                    </div>
                                    <div class="ft-vehicle-option" data-value="electrique">
                                        <img src="https://cdn.prod.website-files.com/6889fc5ff91302573d0cb517/688b40f003525dd9a78d5213_voiture-electrique.png" alt="Véhicule électrique">
                                        <span>Électrique</span>
                                    </div>
                                    <div class="ft-vehicle-option" data-value="thermique">
                                        <img src="https://cdn.prod.website-files.com/6889fc5ff91302573d0cb517/688b40ed2c03311f74178439_voiture-thermique.png" alt="Véhicule thermique">
                                        <span>Thermique</span>
                                    </div>
                                </div>
                                <input type="hidden" id="ft-vehicleType" name="vehicleType" value="hybride">
                            </div>

                            <!-- Email -->
                            <div class="ft-form-group">
                                <label for="ft-email" class="ft-form-label">Email</label>
                                <input 
                                    type="email" 
                                    id="ft-email" 
                                    name="email"
                                    class="ft-form-input"
                                    placeholder="votre@email.com"
                                >
                                <div class="ft-error-message" id="ft-email-error"></div>
                            </div>

                            <!-- Buttons -->
                            <div class="ft-button-group">
                                <button type="button" class="ft-btn ft-btn-primary" id="ft-resultBtn">Calculer</button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Results Section -->
                <div id="resultsSection" style="display: none;">
                    <div class="ft-results-container">
                        <!-- Unified results card combining header and breakdown -->
                        <div class="ft-unified-results-card">
                            <!-- Header section -->
                            <div class="ft-card-header">
                                <div class="ft-header-left">
                                    <h2 class="ft-main-title">Salaire Net avec INCOM</h2>
                                    <div class="ft-gross-salary-line" id="result-gross-salary-line">Salaire brut : 1463 € / mois</div>
                                </div>
                                <div class="ft-header-right">
                                    <div class="ft-total-amount" id="result-total-amount">1900 €</div>
                                    <div class="ft-restitution-pill" id="result-restitution-pill">78 % de restitution</div>
                                </div>
                            </div>
                            
                            <!-- Separator line -->
                            <div class="ft-card-separator"></div>
                            
                            <!-- Breakdown section -->
                            <div class="ft-card-breakdown">
                                <!-- Salaire Net Avant Impôts -->
                                <div class="ft-breakdown-item">
                                    <div class="ft-item-left">
                                        <span class="ft-item-icon">💰</span>
                                        <span class="ft-item-label">Salaire net avant impôts</span>
                                    </div>
                                    <div class="ft-item-connector"></div>
                                    <div class="ft-item-right">
                                        <span class="ft-item-amount" id="component-salaire-net">497,33 €</span>
                                    </div>
                                </div>

                                <!-- Indemnités kilométriques -->
                                <div class="ft-breakdown-item">
                                    <div class="ft-item-left">
                                        <span class="ft-item-icon">🚗</span>
                                        <span class="ft-item-label">Indemnités kilométriques</span>
                                    </div>
                                    <div class="ft-item-connector"></div>
                                    <div class="ft-item-right">
                                        <span class="ft-item-amount" id="component-indemnites-km">2 049,60 €</span>
                                    </div>
                                </div>

                                <!-- Indemnités repas -->
                                <div class="ft-breakdown-item">
                                    <div class="ft-item-left">
                                        <span class="ft-item-icon">🍟</span>
                                        <span class="ft-item-label">Indemnités repas</span>
                                    </div>
                                    <div class="ft-item-connector"></div>
                                    <div class="ft-item-right">
                                        <span class="ft-item-amount" id="component-indemnites-repas">485,30 €</span>
                                    </div>
                                </div>

                                <!-- Indemnités Congés Payés -->
                                <div class="ft-breakdown-item">
                                    <div class="ft-item-left">
                                        <span class="ft-item-icon">🎨</span>
                                        <span class="ft-item-label">Indemnités Congés Payés</span>
                                    </div>
                                    <div class="ft-item-connector"></div>
                                    <div class="ft-item-right">
                                        <span class="ft-item-amount" id="component-conges-payes">62,96 €</span>
                                    </div>
                                </div>

                                <!-- Provision de fin de contrat -->
                                <div class="ft-breakdown-item">
                                    <div class="ft-item-left">
                                        <span class="ft-item-icon">🤝</span>
                                        <span class="ft-item-label">Provision de fin de contrat (PFC)</span>
                                    </div>
                                    <div class="ft-item-connector"></div>
                                    <div class="ft-item-right">
                                        <span class="ft-item-amount" id="component-rupture-conventionnelle">13,23 €</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Image (will be reordered on mobile) -->
                        <!-- Text content -->
                        <div class="ft-results-text">
                            <h3>Pourquoi choisir INCOM ?</h3>
                            <p>Rejoignez les centaines de chauffeurs qui ont déjà choisi la sécurité du salariat tout en préservant leur liberté. Avec INCOM, profitez d'un statut salarié, de protections sociales solides et d'un accompagnement adapté à votre activité.</p>
                            
                            <!-- Action Button -->
                            <div class="ft-results-actions">
                                <a href="https://incom-services.typeform.com/website" class="ft-btn ft-btn-primary" id="ft-joinBtn" target="_blank">Rejoindre INCOM</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function() {
            'use strict';
            
            // Financial Tool Data Storage
            let financialToolData = {
                turnover: '',
                expenses: '',
                vehicleType: 'hybride',
                ownership: '',
                monthlyPayment: '',
                email: ''
            };

            // Initialize the financial tool
            function initFinancialTool() {
                setupEventListeners();
            }

            function populateForm() {
                // Populate inputs - store raw numbers without euro symbol
                document.getElementById('ft-turnover').value = financialToolData.turnover || '';
                document.getElementById('ft-expenses').value = financialToolData.expenses || '';
                document.getElementById('ft-monthly-payment').value = financialToolData.monthlyPayment || '';
                document.getElementById('ft-email').value = financialToolData.email || '';
                
                // Set vehicle type
                document.querySelectorAll('.ft-vehicle-option').forEach(option => {
                    option.classList.remove('ft-selected');
                    if (option.dataset.value === financialToolData.vehicleType) {
                        option.classList.add('ft-selected');
                    }
                });
                
                // Set custom dropdown and handle conditional field
                if (financialToolData.ownership) {
                    const dropdownSelected = document.getElementById('ft-ownership-selected');
                    const placeholder = dropdownSelected.querySelector('.ft-dropdown-placeholder');
                    const ownershipInput = document.getElementById('ft-ownership');
                    
                    ownershipInput.value = financialToolData.ownership;
                    placeholder.textContent = getOwnershipLabel(financialToolData.ownership);
                    dropdownSelected.classList.add('ft-has-value');
                    handleOwnershipChange(financialToolData.ownership);
                }
            }

            function setupEventListeners() {
                // Vehicle type selection
                const vehicleOptions = document.querySelectorAll('.ft-vehicle-option');
                vehicleOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        vehicleOptions.forEach(opt => opt.classList.remove('ft-selected'));
                        this.classList.add('ft-selected');
                        const value = this.dataset.value;
                        document.getElementById('ft-vehicleType').value = value;
                        financialToolData.vehicleType = value;
                    });
                });

                // Enhanced currency formatting for inputs
                const turnoverInput = document.getElementById('ft-turnover');
                const expensesInput = document.getElementById('ft-expenses');
                const monthlyPaymentInput = document.getElementById('ft-monthly-payment');

                [turnoverInput, expensesInput, monthlyPaymentInput].forEach(input => {
                    // Handle input event for real-time formatting
                    input.addEventListener('input', function(e) {
                        handleCurrencyInput(this, e);
                    });

                    // Handle keydown for better backspace/delete handling
                    input.addEventListener('keydown', function(e) {
                        handleCurrencyKeydown(this, e);
                    });

                    input.addEventListener('blur', function() {
                        const fieldName = this.id.replace('ft-', '').replace('-', '');
                        // Store the raw numeric value without formatting
                        if (fieldName === 'monthlypayment') {
                            financialToolData.monthlyPayment = extractNumericValue(this.value);
                        } else {
                            financialToolData[fieldName] = extractNumericValue(this.value);
                        }
                    });

                    // Handle focus to position cursor correctly
                    input.addEventListener('focus', function() {
                        // Move cursor to end of number part (before spaces)
                        const value = this.value;
                        const numericPart = value.replace(/\s/g, '');
                        setTimeout(() => {
                            this.setSelectionRange(numericPart.length, numericPart.length);
                        }, 0);
                    });
                });

                // Custom dropdown handling
                const customDropdown = document.getElementById('ft-ownership-dropdown');
                const dropdownSelected = document.getElementById('ft-ownership-selected');
                const dropdownOptions = document.getElementById('ft-ownership-options');
                const ownershipInput = document.getElementById('ft-ownership');

                // Toggle dropdown
                dropdownSelected.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const isOpen = customDropdown.classList.contains('ft-open');
                    
                    // Close all other dropdowns (if any)
                    document.querySelectorAll('.ft-custom-dropdown.ft-open').forEach(dropdown => {
                        dropdown.classList.remove('ft-open');
                    });
                    
                    if (!isOpen) {
                        customDropdown.classList.add('ft-open');
                    }
                });

                // Handle option selection
                dropdownOptions.addEventListener('click', function(e) {
                    if (e.target.classList.contains('ft-dropdown-option')) {
                        const value = e.target.dataset.value;
                        const text = e.target.textContent;
                        
                        // Update the display
                        const placeholder = dropdownSelected.querySelector('.ft-dropdown-placeholder');
                        placeholder.textContent = text;
                        dropdownSelected.classList.add('ft-has-value');
                        
                        // Update the hidden input
                        ownershipInput.value = value;
                        financialToolData.ownership = value;
                        
                        // Handle conditional field
                        handleOwnershipChange(value);
                        
                        // Close dropdown
                        customDropdown.classList.remove('ft-open');
                        
                        // Clear any error
                        dropdownSelected.classList.remove('ft-error');
                        document.getElementById('ft-ownership-error').textContent = '';
                    }
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', function() {
                    customDropdown.classList.remove('ft-open');
                });

                // Keyboard support for dropdown
                dropdownSelected.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        dropdownSelected.click();
                    } else if (e.key === 'Escape') {
                        customDropdown.classList.remove('ft-open');
                    }
                });

                // Add tabindex for keyboard navigation
                dropdownSelected.setAttribute('tabindex', '0');

                // Email input
                const emailInput = document.getElementById('ft-email');
                emailInput.addEventListener('blur', function() {
                    financialToolData.email = this.value;
                });

                // INCOM Info Box toggle functionality
                const incomInfoBox = document.getElementById('incomInfoBox');
                const incomInfoHeader = document.getElementById('incomInfoHeader');
                const incomInfoContent = document.getElementById('incomInfoContent');
                const incomInfoArrow = document.getElementById('incomInfoArrow');

                // Check if mobile
                function isMobile() {
                    return window.innerWidth <= 768;
                }

                function initInfoBox() {
                    if (isMobile()) {
                        // Mobile: start collapsed
                        incomInfoBox.classList.remove('mobile-expanded');
                        incomInfoBox.classList.remove('collapsed');
                        incomInfoArrow.textContent = '▼';
                    } else {
                        // Desktop: start expanded
                        incomInfoBox.classList.remove('mobile-expanded');
                        incomInfoBox.classList.remove('collapsed');
                        incomInfoArrow.textContent = '▲';
                    }
                }

                // Initialize on load
                initInfoBox();

                // Reinitialize on window resize
                window.addEventListener('resize', initInfoBox);

                if (incomInfoHeader && incomInfoBox) {
                    incomInfoHeader.addEventListener('click', function() {
                        // Only allow interaction on mobile
                        if (!isMobile()) {
                            return; // Do nothing on desktop
                        }
                        
                        // Mobile logic only
                        const isExpanded = incomInfoBox.classList.contains('mobile-expanded');
                        
                        if (isExpanded) {
                            incomInfoBox.classList.remove('mobile-expanded');
                            incomInfoArrow.textContent = '▼';
                        } else {
                            incomInfoBox.classList.add('mobile-expanded');
                            incomInfoArrow.textContent = '▲';
                        }
                    });
                }

                // Button handlers
                document.getElementById('ft-resultBtn').addEventListener('click', function() {
                    validateAndSubmit();
                });

            }

            function handleOwnershipChange(value) {
                const paymentGroup = document.getElementById('ft-payment-group');
                const paymentLabel = document.getElementById('ft-payment-label');
                const paymentInput = document.getElementById('ft-monthly-payment');
                
                if (value === 'credit' || value === 'leasing') {
                    paymentGroup.style.display = 'block';
                    if (value === 'credit') {
                        paymentLabel.textContent = 'Montant mensuel du crédit';
                        paymentInput.placeholder = '300';
                    } else if (value === 'leasing') {
                        paymentLabel.textContent = 'Montant mensuel du leasing';
                        paymentInput.placeholder = '450';
                    }
                } else {
                    paymentGroup.style.display = 'none';
                    paymentInput.value = '';
                    financialToolData.monthlyPayment = '';
                }
            }

            function extractNumericValue(value) {
                return value.replace(/[^\d]/g, '');
            }

            function handleCurrencyKeydown(input, e) {
                const value = input.value;
                const cursorPos = input.selectionStart;
                
                // Allow navigation keys, backspace, delete, tab, etc.
                if ([8, 9, 27, 13, 46, 35, 36, 37, 38, 39, 40].indexOf(e.keyCode) !== -1 ||
                    // Allow Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X
                    (e.keyCode === 65 && e.ctrlKey === true) ||
                    (e.keyCode === 67 && e.ctrlKey === true) ||
                    (e.keyCode === 86 && e.ctrlKey === true) ||
                    (e.keyCode === 88 && e.ctrlKey === true)) {
                    return;
                }
                
                // Ensure that it's a number and stop the keypress
                if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                    e.preventDefault();
                }
            }

            function handleCurrencyInput(input, e) {
                // Get the current value and extract only digits
                let value = input.value.replace(/[^\d]/g, '');
                
                // If empty, just clear the input
                if (!value) {
                    input.value = '';
                    return;
                }
                
                // Convert to number and format with spaces for thousands
                const numericValue = parseInt(value);
                const formattedValue = numericValue.toLocaleString('fr-FR', {
                    useGrouping: true,
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).replace(/,/g, ' '); // Replace commas with spaces for French formatting
                
                // Store cursor position before formatting
                const cursorPosition = input.selectionStart;
                const oldLength = input.value.length;
                
                // Set the formatted value
                input.value = formattedValue;
                
                // Adjust cursor position after formatting
                const newLength = input.value.length;
                const lengthDiff = newLength - oldLength;
                const newCursorPos = Math.max(0, Math.min(cursorPosition + lengthDiff, formattedValue.length));
                
                // Set cursor position
                setTimeout(() => {
                    input.setSelectionRange(newCursorPos, newCursorPos);
                }, 0);
            }

            function validateAndSubmit() {
                clearErrors();
                let isValid = true;

                // Update formData with current values - extract numeric values
                financialToolData.turnover = extractNumericValue(document.getElementById('ft-turnover').value);
                financialToolData.expenses = extractNumericValue(document.getElementById('ft-expenses').value);
                financialToolData.monthlyPayment = extractNumericValue(document.getElementById('ft-monthly-payment').value);
                financialToolData.email = document.getElementById('ft-email').value;
                financialToolData.ownership = document.getElementById('ft-ownership').value;

                // Validate turnover
                if (!financialToolData.turnover || financialToolData.turnover.trim() === '') {
                    showError('ft-turnover', 'Le chiffre d\'affaires est requis');
                    isValid = false;
                }

                // Validate ownership
                if (!financialToolData.ownership) {
                    showError('ft-ownership', 'Veuillez sélectionner la titularité du véhicule');
                    isValid = false;
                }

                // Validate monthly payment if credit or leasing is selected
                if ((financialToolData.ownership === 'credit' || financialToolData.ownership === 'leasing') && 
                    (!financialToolData.monthlyPayment || financialToolData.monthlyPayment.trim() === '')) {
                    showError('ft-monthly-payment', 'Le montant mensuel est requis');
                    isValid = false;
                }

                // Validate expenses
                if (!financialToolData.expenses || financialToolData.expenses.trim() === '') {
                    showError('ft-expenses', 'Le montant des frais professionnels est requis');
                    isValid = false;
                }

                // Validate email
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!financialToolData.email || !emailRegex.test(financialToolData.email)) {
                    showError('ft-email', 'Veuillez saisir une adresse email valide');
                    isValid = false;
                }

                if (isValid) {
                    calculateAndShowResults();
                } else {
                    // Scroll to first error
                    const firstError = document.querySelector('.ft-form-input.ft-error');
                    if (firstError) {
                        firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
            }

            function calculateAndShowResults() {
                // Convert string values to numbers
                const caNetTTC = parseFloat(financialToolData.turnover) || 0;
                const fraisPro = parseFloat(financialToolData.expenses) || 0;
                const vehicleType = financialToolData.vehicleType;
                const ownership = financialToolData.ownership;
                const monthlyPayment = parseFloat(financialToolData.monthlyPayment) || 0;

                console.log('=== NOUVEAU CALCUL SELON LES SPÉCIFICATIONS ===');
                console.log('CA Net TTC:', caNetTTC);

                // 1. Calculate CA Brut TTC, TVA Due, and CA Net HT
                const caBrutTTC = caNetTTC / 0.7; // CA NET TTC ÷ 0.7
                const tvaDueNegative = -(caBrutTTC * 0.10); // CA BRUT TTC × 10% (NEGATIVE)
                const caNetHT = caNetTTC + tvaDueNegative; // CA NET TTC + TVA DUE (TVA Due is negative, so this is actually subtraction)
                
                console.log('CA Brut TTC (CA Net TTC ÷ 0.7):', caBrutTTC);
                console.log('TVA Due (CA Brut TTC × 10% - NEGATIVE):', tvaDueNegative);
                console.log('CA Net HT (CA Net TTC + TVA Due):', caNetHT);

                // 2. Indemnité kilométrique
                let coefKm;
                let vehicleNote;
                switch(vehicleType) {
                    case 'electrique':
                        coefKm = 0.51240; // 51.240%
                        vehicleNote = '(Électrique - 51.240%)';
                        break;
                    case 'hybride':
                    case 'thermique':
                    default:
                        coefKm = 0.427; // 42.7%
                        vehicleNote = vehicleType === 'hybride' ? '(Hybride - 42.7%)' : '(Thermique - 42.7%)';
                        break;
                }
                const indemniteKm = -(coefKm * caNetTTC); // Negative because it's a deduction
                console.log(`Indemnité kilométrique ${vehicleNote}:`, indemniteKm);

                // 3. Frais INCOM calculation (moved here to be available for TVA calculation)
                const fraisIncomBase = caNetHT * 0.15; // 15% of CA net HT
                const fraisIncom = fraisIncomBase < 720 ? -fraisIncomBase : -720; // Negative amount
                console.log('Frais INCOM base (15% CA net HT):', fraisIncomBase);
                console.log('Frais INCOM (negative):', fraisIncom);

                // 4. TVA déductible calculation
                // TVA due = 20% of CA Brut TTC
                const tvaDue = caBrutTTC * 0.20;

                // TVA récupérable components:
                // 1. 20% of Frais INCOM (absolute positive value)
                const tvaFraisIncom = Math.abs(fraisIncom) * 0.20;
                
                // 2. 20% of vehicle cost if leasing, 0 otherwise
                let tvaVehicle = 0;
                if (ownership === 'leasing') {
                    tvaVehicle = monthlyPayment * 0.20;
                }
                // Note: For 'credit', vehicle TVA = 0 as specified

                // 3. 20% on expense notes (frais pro)
                const tvaExpenses = fraisPro * 0.20;

                // Total TVA récupérable
                const tvaRecuperableTotal = tvaFraisIncom + tvaVehicle + tvaExpenses;

                // TVA déductible = minimum between TVA récupérable and TVA due
                const tvaDeductible = Math.min(tvaRecuperableTotal, tvaDue);
                
                console.log('TVA Frais INCOM (20% de |Frais INCOM|):', tvaFraisIncom);
                console.log('TVA véhicule (20% si leasing):', tvaVehicle);
                console.log('TVA frais pro (20%):', tvaExpenses);
                console.log('TVA due (20% CA Brut TTC):', tvaDue);
                console.log('TVA récupérable total:', tvaRecuperableTotal);
                console.log('TVA déductible (minimum entre récupérable et due):', tvaDeductible);

                // 5. CA NET Driver calculation
                const caNetDriver = caNetHT - Math.abs(fraisIncom); // CA net HT - Frais INCOM (subtracting absolute value)
                console.log('CA NET Driver (CA net HT - Frais INCOM):', caNetDriver);

                // 6. Indemnité repas (negative amount - expense)
                const revenueRatio = caNetTTC / 100;
                let indemniteRepas;
                if (revenueRatio < 23) {
                    indemniteRepas = -(revenueRatio * 21.1); // Negative because it's an expense
                } else {
                    indemniteRepas = -(23 * 21.1); // Capped at 23 days, negative because it's an expense
                }
                console.log('Ratio CA/100:', revenueRatio);
                console.log('Indemnité repas (dépense):', indemniteRepas);

                // 7. Calculate final result: Salaire Brut Avant Impôts
                const salaireBrutAvantImpots = caNetDriver + indemniteKm + tvaDeductible + indemniteRepas;

                // 8. Calculate Equivalent Unité d'Œuvre au SMIC and Salaire Net Avant Impôts
                const equivalentUniteOeuvre = salaireBrutAvantImpots / 13.84;
                const salaireNetAvantImpots = equivalentUniteOeuvre * 9.40;

                // 9. Calculate final allowances and Salaire Net
                const indemniteCongesPayes = equivalentUniteOeuvre * 1.19;
                const indemniteRuptureConventionnelle = equivalentUniteOeuvre * 0.25;
                // For Salaire Net calculation, all components are positive (absolute values)
                const salaireNet = salaireNetAvantImpots + Math.abs(indemniteKm) + Math.abs(indemniteRepas) + indemniteCongesPayes + indemniteRuptureConventionnelle;

                // Calculate percentage of CA Net TTC
                const pourcentageRestitution = Math.round((salaireNet / caNetTTC) * 100);
                
                console.log('=== CALCUL FINAL ===');
                console.log('CA Net HT:', caNetHT);
                console.log('Frais INCOM:', fraisIncom);
                console.log('CA NET Driver:', caNetDriver);
                console.log('Indemnité kilométrique (déduction):', indemniteKm);
                console.log('TVA déductible (ajout):', tvaDeductible);
                console.log('Indemnité repas (déduction):', indemniteRepas);
                console.log('SALAIRE BRUT AVANT IMPÔTS (CA NET Driver + composants):', salaireBrutAvantImpots);
                console.log('Equivalent Unité d\'Œuvre au SMIC (÷ 13.84):', equivalentUniteOeuvre);
                console.log('SALAIRE NET AVANT IMPÔTS (Unité d\'Œuvre × 9.40):', salaireNetAvantImpots);
                console.log('Indemnités Congés Payés (Unité d\'Œuvre × 1.19):', indemniteCongesPayes);
                console.log('Indemnités Rupture Conventionnelle (Unité d\'Œuvre × 0.25):', indemniteRuptureConventionnelle);
                console.log('=== SALAIRE NET (TOUS POSITIFS) ===');
                console.log('Salaire Net Avant Impôts:', salaireNetAvantImpots);
                console.log('+ Indemnité kilométrique (abs):', Math.abs(indemniteKm));
                console.log('+ Indemnité repas (abs):', Math.abs(indemniteRepas));
                console.log('+ Indemnités Congés Payés:', indemniteCongesPayes);
                console.log('+ Indemnités Rupture Conventionnelle:', indemniteRuptureConventionnelle);
                console.log('SALAIRE NET FINAL:', salaireNet);
                console.log('POURCENTAGE DE RESTITUTION:', pourcentageRestitution + '%');

                // Display results
                displayResults({
                    caNetTTC: caNetTTC,
                    salaireBrutAvantImpots: salaireBrutAvantImpots,
                    salaireNetAvantImpots: salaireNetAvantImpots,
                    indemniteKm: indemniteKm,
                    indemniteRepas: indemniteRepas,
                    indemniteCongesPayes: indemniteCongesPayes,
                    indemniteRuptureConventionnelle: indemniteRuptureConventionnelle,
                    salaireNet: salaireNet,
                    pourcentageRestitution: pourcentageRestitution
                });
            }

            // Airtable integration function
            async function sendToAirtable(formData, calculatedResult) {
                console.log('🔍 DEBUG: sendToAirtable appelée');
                console.log('🔍 DEBUG: formData reçue:', formData);
                console.log('🔍 DEBUG: calculatedResult reçu:', calculatedResult);
                
                const AIRTABLE_API_TOKEN = 'patMDlNh5ZIAwmqPs.af8155ce6bf8be0388920787c233404a3ac7de874aac7c0ab3a2be1efd5400da';
                const BASE_ID = 'appBEi11h3O2V5Dnx';
                const TABLE_NAME = encodeURIComponent('Website Simulateur');
                const ENDPOINT = `https://api.airtable.com/v0/${BASE_ID}/${TABLE_NAME}`;
                
                console.log('🔍 DEBUG: Endpoint Airtable:', ENDPOINT);

                try {
                    // Prepare the data for Airtable
                    const airtableData = {
                        records: [{
                            fields: {
                                'Email': formData.email || '',
                                'Chiffre d\'affaires': formData.turnover ? parseInt(formData.turnover) : 0,
                                'Frais professionnels': formData.expenses ? parseInt(formData.expenses) : 0,
                                'Type véhicule': formData.vehicleType || '',
                                'Titularité véhicule': formData.ownership || '',
                                'Montant mensuel': formData.monthlyPayment ? parseInt(formData.monthlyPayment) : null,
                                'Date soumission': new Date().toISOString(),
                                'Résultat calculé': calculatedResult || ''
                            }
                        }]
                    };
                    
                    console.log('🔍 DEBUG: Données préparées pour Airtable:', JSON.stringify(airtableData, null, 2));

                    // Send data to Airtable
                    console.log('🔍 DEBUG: Envoi vers Airtable...');
                    const response = await fetch(ENDPOINT, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${AIRTABLE_API_TOKEN}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(airtableData)
                    });

                    console.log('🔍 DEBUG: Réponse reçue, status:', response.status);
                    
                    if (response.ok) {
                        const result = await response.json();
                        console.log('✅ Données envoyées avec succès à Airtable:', result);
                    } else {
                        const errorText = await response.text();
                        console.error('❌ Erreur Airtable:', response.status, errorText);
                        console.error('❌ Headers de réponse:', response.headers);
                    }
                } catch (error) {
                    console.error('❌ Erreur lors de l\'envoi vers Airtable:', error);
                    console.error('❌ Stack trace:', error.stack);
                    // N'interrompt pas l'expérience utilisateur en cas d'erreur
                }
            }

            function displayResults(results) {
                // Hide the form text content (heading and info box)
                const formTextContent = document.getElementById('formTextContent');
                if (formTextContent) {
                    formTextContent.style.display = 'none';
                }

                // Force mobile layout on small screens
                if (window.innerWidth <= 768) {
                    const resultsContainer = document.querySelector('.ft-results-container');
                    const resultsRight = document.querySelector('.ft-results-right');
                    if (resultsContainer && resultsRight) {
                        resultsContainer.style.flexDirection = 'column';
                        resultsRight.style.order = '2';
                        resultsRight.style.marginTop = '40px';
                    }
                }

                // Calculate comparison values
                // INCOM salary (with benefits)
                const incomSalary = results.salaireNet;
                const incomPercentage = results.pourcentageRestitution;
                const grossSalaryEquivalent = results.salaireBrutAvantImpots;

                // Update new header section
                document.getElementById('result-restitution-pill').textContent = `${incomPercentage} % de restitution`;
                document.getElementById('result-gross-salary-line').textContent = `Salaire brut : ${formatEuroNoDecimals(grossSalaryEquivalent)} / mois`;
                document.getElementById('result-total-amount').textContent = formatEuroNoDecimals(incomSalary);

                // Update salary components with new format
                document.getElementById('component-salaire-net').textContent = formatEuroWithDecimals(results.salaireNetAvantImpots);

                document.getElementById('component-indemnites-km').textContent = formatEuroWithDecimals(Math.abs(results.indemniteKm));

                document.getElementById('component-indemnites-repas').textContent = formatEuroWithDecimals(Math.abs(results.indemniteRepas));

                document.getElementById('component-conges-payes').textContent = formatEuroWithDecimals(results.indemniteCongesPayes);

                document.getElementById('component-rupture-conventionnelle').textContent = formatEuroWithDecimals(results.indemniteRuptureConventionnelle);

                // Hide form and show results
                document.getElementById('formSection').style.display = 'none';
                document.getElementById('resultsSection').style.display = 'block';

                // Send data to Airtable after displaying results
                const calculatedResult = document.getElementById('result-total-amount').textContent;
                console.log('🔍 DEBUG: Avant appel sendToAirtable');
                console.log('🔍 DEBUG: financialToolData avant appel:', financialToolData);
                console.log('🔍 DEBUG: calculatedResult avant appel:', calculatedResult);
                sendToAirtable(financialToolData, calculatedResult);
            }

            function formatEuro(value) {
                return new Intl.NumberFormat('fr-FR', {
                    style: 'currency',
                    currency: 'EUR',
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).format(value);
            }

            function formatEuroNoDecimals(value) {
                return new Intl.NumberFormat('fr-FR', {
                    style: 'currency',
                    currency: 'EUR',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(value);
            }

            function formatEuroWithDecimals(value) {
                return new Intl.NumberFormat('fr-FR', {
                    style: 'currency',
                    currency: 'EUR',
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).format(value);
            }

            function restartSimulation() {
                // Show the form text content again
                const formTextContent = document.getElementById('formTextContent');
                if (formTextContent) {
                    formTextContent.style.display = 'block';
                }

                // Reset form data
                financialToolData = {
                    turnover: '',
                    expenses: '',
                    vehicleType: 'hybride',
                    ownership: '',
                    monthlyPayment: '',
                    email: ''
                };

                // Clear form inputs
                document.getElementById('ft-turnover').value = '';
                document.getElementById('ft-expenses').value = '';
                document.getElementById('ft-monthly-payment').value = '';
                document.getElementById('ft-email').value = '';
                document.getElementById('ft-ownership').value = '';

                // Reset dropdown
                const dropdownSelected = document.getElementById('ft-ownership-selected');
                const placeholder = dropdownSelected.querySelector('.ft-dropdown-placeholder');
                placeholder.textContent = 'Sélectionnez une option';
                dropdownSelected.classList.remove('ft-has-value');

                // Reset vehicle selection
                document.querySelectorAll('.ft-vehicle-option').forEach(option => {
                    option.classList.remove('ft-selected');
                    if (option.dataset.value === 'hybride') {
                        option.classList.add('ft-selected');
                    }
                });
                document.getElementById('ft-vehicleType').value = 'hybride';

                // Hide payment group
                document.getElementById('ft-payment-group').style.display = 'none';

                // Clear errors
                clearErrors();

                // Show form and hide results
                document.getElementById('formSection').style.display = 'block';
                document.getElementById('resultsSection').style.display = 'none';
            }

            function formatCurrency(value) {
                return new Intl.NumberFormat('fr-FR', {
                    style: 'currency',
                    currency: 'EUR',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(value);
            }

            function formatDisplayValue(value) {
                if (!value) return '';
                const numericValue = parseInt(value);
                return numericValue.toLocaleString('fr-FR');
            }

            function showError(fieldId, message) {
                const field = document.getElementById(fieldId);
                const errorElement = document.getElementById(fieldId + '-error');
                
                if (fieldId === 'ft-ownership') {
                    // Handle custom dropdown error styling
                    const dropdownSelected = document.getElementById('ft-ownership-selected');
                    if (dropdownSelected) {
                        dropdownSelected.classList.add('ft-error');
                    }
                } else if (field) {
                    field.classList.add('ft-error');
                }
                
                if (errorElement) {
                    errorElement.textContent = message;
                }
            }

            function clearErrors() {
                const errorElements = document.querySelectorAll('.ft-error-message');
                const inputElements = document.querySelectorAll('.ft-form-input');
                const dropdownSelected = document.getElementById('ft-ownership-selected');
                
                errorElements.forEach(el => el.textContent = '');
                inputElements.forEach(el => el.classList.remove('ft-error'));
                
                if (dropdownSelected) {
                    dropdownSelected.classList.remove('ft-error');
                }
            }

            function getOwnershipLabel(value) {
                const labels = {
                    'owner': 'Propriétaire',
                    'credit': 'Crédit véhicule (financement)',
                    'leasing': 'Leasing / Location longue durée'
                };
                return labels[value] || value;
            }

            // Initialize when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initFinancialTool);
            } else {
                initFinancialTool();
            }
        })();
    </script>
</body>
</html>
